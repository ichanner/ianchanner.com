
<!DOCTYPE Html>

<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name='description' content="Ian Channer Dot Com">
	<title>Ian Channer</title>
	<link rel="stylesheet" href="https://latex.now.sh/style.css">
</head>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<body>

	<center>
		<h1> Ian Channer Dot Com </h1>
		<i> DISCLAIMER: Any actual names or likenesses of people are used in a fictitious and parodic manner</i>
		<div class="blog" id="blog"/>
	</center>
	<center>
		</br>
		<button id='load' onclick="return loadPreviews(false);">Load More</button>
	</center>

</body>

<script type="text/javascript">

	var index = 0;
	var count = 0;
	const load_button =  document.getElementById('load')
	const container = document.getElementById('blog')	

	function createPreview(title, id){

		const div = document.createElement('div')
		const br = document.createElement('br')
		const link = document.createElement('a')
		const name = document.createTextNode(title)

		div.appendChild(link)
		link.href = '/posts/' + id
		link.appendChild(name)
		container.appendChild(br)
		container.appendChild(div)
	}
			
	function loadPreviews(first_time){

		const next = first_time ? (Number(sessionStorage.getItem('index')) || 0) : index

		axios.get('/articles/'+next.toString()+'?first_time='+first_time).then((res)=>{

			res.data.forEach((article, i)=>{
			
				index+=1;
				if(count-1 == index) load_button.remove()
				sessionStorage.setItem('index', index)
				createPreview(article.title, article.id)

				if(i == res.data.length-1){

					if (sessionStorage.getItem("scroll") != null) {

				        $(window).scrollTop(sessionStorage.getItem("scroll"));
				    }
				}
			})
		})
	}

	$(document).ready(function () {

	  	$(window).on("scroll", function() {

	        sessionStorage.setItem("scroll", $(window).scrollTop());
	    });
	  
  	});

	axios.get('/count').then((res)=>{

		count = res.data;
		loadPreviews(true)
	})

</script>

</html>


