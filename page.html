<!DOCTYPE HTML>

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:description">
	<meta property="og:title">
	<title>Ian Channer</title>
	<link rel="stylesheet" href="https://latex.now.sh/style.css">

</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<body>


	<button id='back' onclick="location.href='/'">Back</button>

	<center>

		<div class="bg" id="bg">
			
			<h2 id="title"> </h2>
			<i id="date"></i>
			<div id='reads'></div>
			<div id='container'></div>

		</div>

	</center>

</body>

<script type="text/javascript">
	
	const container = document.getElementById('container')
	const title = document.getElementById('title')
	const reads = document.getElementById('reads')
	const meta_desc = document.querySelector('meta[property="og:description"]')
	const meta_title = document.querySelector('meta[property="og:title"]')
	const url = new URL(window.location.href)
	const paths = String(url).split('/')
	const id = paths[paths.length-1]

	axios.get('/article/'+id+'?is_refresh=false').then((res)=>{

		const strippedTitle = res.data.title.replace(/(<([^>]+)>)/gi, "");
		const strippedBody = res.data.body.replace(/(<([^>]+)>)/gi, "");
		meta_desc.setAttribute('content', strippedBody);
		meta_title.setAttribute('content', strippedTitle);
	})

	function loadArticle(is_refresh){

		axios.get('/article/'+id+'?is_refresh='+is_refresh).then((res)=>{

			title.appendChild(document.createTextNode(res.data.title))
			reads.appendChild(document.createTextNode(res.data.views + " Views"))
     		date.appendChild(document.createTextNode(res.data.created_at))
	
			container.innerHTML = res.data.body
		})
	}

	$(document).ready(function () {

		console.log(performance.navigation.type)

		if (performance.navigation.type === 0) {
			
			loadArticle(false)
		}
		else if(performance.navigation.type === 1){

			loadArticle(true)
		}
	  
  	});

</script>

</html>